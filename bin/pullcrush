#!/usr/bin/env ruby

begin
  require 'pullcrusher'
rescue LoadError
  require 'rubygems'
  require 'pullcrusher'
end

#include Pullcrusher

def parse_repo_from_args
    format_desc = "Repo name should be in github shorthand style, e.g. 'mroth/pullcrusher'"
    if ARGV.count != 1
        puts "Usage: pullcrush [github_repo]"
        puts format_desc
        exit 0
    end

    #TODO: test for proper format

    ARGV[0]
end

#
# create an authorized github client, handles prompting if needed
#
authclient = GitHubAuth.client

#
# instantiate a Pullcrusher object with that authclient
#
pc = Pullcrusher::Pullcrusher.new(authclient)

#
# do it!
#
repo_name = parse_repo_from_args
results, fs_repo = pc.process_repo( repo_name )
exit if (results.filez_optimized < 1)

input = ask "Do you want to automatically fork and pull request? [y/N] "
if input.match /[yY]/
    pc.fork_and_pull(fs_repo, repo_name, results)
end

